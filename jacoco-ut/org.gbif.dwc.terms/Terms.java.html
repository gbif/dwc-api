<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Terms.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Darwin Core API</a> &gt; <a href="index.source.html" class="el_package">org.gbif.dwc.terms</a> &gt; <span class="el_source">Terms.java</span></div><h1>Terms.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2021 Global Biodiversity Information Facility (GBIF)
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.gbif.dwc.terms;

import java.lang.annotation.Annotation;
import java.util.Arrays;
import java.util.List;
import java.util.Map;
import java.util.regex.Pattern;
import java.util.stream.Collectors;
import java.util.stream.Stream;

/**
 * Utility methods for {@link Term}
 */
public class Terms {

<span class="fc" id="L31">  private static final Pattern NULL_PATTERN = Pattern.compile(&quot;^\\s*(\\\\N|\\\\?NULL)\\s*$&quot;);</span>
<span class="fc" id="L32">  private static final List&lt;Term&gt; VOCABULARY_BACKED_TERMS = findVocabularyBackedTerms();</span>

  /**
   * static utility class
   */
  private Terms() {
  }

  /**
   * Tries various terms in given order until it finds a non empty value.
   *
   * @return value or null
   */
  public static String getValueOfFirst(Map&lt;Term, String&gt; record, Term... terms) {
<span class="pc bpc" id="L46" title="1 of 2 branches missed.">    for (Term t : terms) {</span>
<span class="pc bpc" id="L47" title="1 of 2 branches missed.">      if (record.containsKey(t)) {</span>
<span class="fc" id="L48">        String val = clean(record.get(t));</span>
<span class="fc bfc" id="L49" title="All 2 branches covered.">        if (val != null) {</span>
<span class="fc" id="L50">          return val;</span>
        }
      }
    }
<span class="nc" id="L54">    return null;</span>
  }

  private static String clean(String str) {
<span class="fc bfc" id="L58" title="All 2 branches covered.">    if (isTermValueBlank(str)) {</span>
<span class="fc" id="L59">      return null;</span>
    }
<span class="fc" id="L61">    str = str.trim();</span>
<span class="pc bpc" id="L62" title="1 of 2 branches missed.">    if (str.isEmpty()) {</span>
<span class="nc" id="L63">      return null;</span>
    }
<span class="fc" id="L65">    return str;</span>
  }

  /**
   * Check if the value provided should be considered &quot;blank&quot; in the context of a {@link Term} value.
   */
  public static boolean isTermValueBlank(String termValue) {
<span class="pc bpc" id="L72" title="1 of 6 branches missed.">    return termValue == null || termValue.isEmpty() || NULL_PATTERN.matcher(termValue).find();</span>
  }

  /**
   * Returns all the {@link Term} that are annotated with {@link Vocabulary}.
   */
  public static List&lt;Term&gt; getVocabularyBackedTerms() {
<span class="nc" id="L79">    return VOCABULARY_BACKED_TERMS;</span>
  }

  private static List&lt;Term&gt; findVocabularyBackedTerms() {
<span class="fc" id="L83">    return Stream.of(getTerms(AcefTerm.class),</span>
<span class="fc" id="L84">                     getTerms(AcTerm.class),</span>
<span class="fc" id="L85">                     getTerms(DcTerm.class),</span>
<span class="fc" id="L86">                     getTerms(DwcaTerm.class),</span>
<span class="fc" id="L87">                     getTerms(DwcTerm.class),</span>
<span class="fc" id="L88">                     getTerms(GadmTerm.class),</span>
<span class="fc" id="L89">                     getTerms(GbifInternalTerm.class),</span>
<span class="fc" id="L90">                     getTerms(GbifTerm.class),</span>
<span class="fc" id="L91">                     getTerms(IucnTerm.class),</span>
<span class="fc" id="L92">                     getTerms(XmpRightsTerm.class),</span>
<span class="fc" id="L93">                     getTerms(XmpTerm.class),</span>
<span class="fc" id="L94">                     getTerms(GbifTerm.class))</span>
<span class="fc" id="L95">      .flatMap(Arrays::stream)</span>
<span class="fc" id="L96">      .filter(Terms::isVocabulary)</span>
<span class="fc" id="L97">      .collect(Collectors.toList());</span>
  }

  private static &lt;T extends Term&gt; Term[] getTerms(Class&lt;T&gt; term) {
<span class="fc" id="L101">    return term.getEnumConstants();</span>
  }

  /**
   * @return true if the term is a handled/annotated as Vocabulary.
   */
  public static boolean isVocabulary(Term term) {
<span class="pc bpc" id="L108" title="1 of 4 branches missed.">    return term instanceof Enum &amp;&amp; hasTermAnnotation(term, Vocabulary.class);</span>
  }

  private static boolean hasTermAnnotation(Term term, Class&lt;? extends Annotation&gt; annotation) {
    try {
<span class="fc" id="L113">      return term.getClass().getField(((Enum&lt;?&gt;) term).name()).isAnnotationPresent(annotation);</span>
<span class="nc" id="L114">    } catch (NoSuchFieldException ex) {</span>
<span class="nc" id="L115">      throw new IllegalArgumentException(ex);</span>
    }
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>